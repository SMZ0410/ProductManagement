
@{
    ViewBag.Title = "Index";
}

<h2>产品列表</h2>

<div>
    应用行业：<select id="selTrea" class="text_sketch" style="width:100px;height:30px">
        <option value="0">--请选择--</option>
    </select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    归属地：<select id="selAddress" class="text_sketch" style="width:100px;height:30px">
        <option value="0">--请选择--</option>
    </select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    产品阶段：<select id="selStage" class="text_sketch" style="width:100px;height:30px">
        <option value="0">--请选择--</option>
    </select><br /><br />
    产品经理：<select id="selManage" class="text_sketch" style="width:100px;height:30px">
        <option value="0">--请选择--</option>
    </select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <input id="txtname" type="text" style="width:150px;height:30px" placeholder="请输入产品名称" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

    <input id="ProductQuery" type="button" value="搜索" class="btn btn-primary" /><br /><br />
</div>

<table class="table table-bordered">
    <thead>
        <tr>
            <td>编号</td>
            <td>产品名称</td>
            <td>创建时间</td>
            <td>产品经理</td>
            <td>应用行业</td>
            <td>归属地</td>
            <td>产品阶段</td>
            <td>详情</td>
            <td>操作</td>
        </tr>
    </thead>
    <tbody id="tb"></tbody>
</table>

<script src="~/Scripts/jquery-3.3.1.min.js"></script>

<script>
    $().ready(function () {
        //获取应用行业
        $.ajax({
            url: "/Product/GetTreade",
            type: "POST",
            dataType: "json",
            success: function (res) {
                $(res.Trades).each(function () {
                    var tp = "<option value='" + this.TradeId + "'>" + this.TradeName + "</option>"
                    $("#selTrea").append(tp);
                })
            }
        })
        //获取产品阶段
        $.ajax({
            url: "/Product/GetStages",
            type: "POST",
            dataType: "json",
            success: function (res) {
                $(res.Stages).each(function () {
                    var tp = "<option value='" + this.StageId + "'>" + this.StageName + "</option>"
                    $("#selStage").append(tp);
                })
            }
        })
        //获取归属地
        $.ajax({
            url: "/Product/GetAddress",
            type: "POST",
            dataType: "json",
            success: function (res) {
                $(res.TrAddress).each(function () {
                    var tp = "<option value='" + this.AddressId + "'>" + this.AddressName + "</option>"
                    $("#selAddress").append(tp);
                })
            }
        })
        //获取产品经理
        $.ajax({
            url: "/Product/GetManage",
            type: "POST",
            dataType: "json",
            success: function (res) {
                $(res.Manages).each(function () {
                    var tp = "<option value='" + this.ProductId + "'>" + this.ProductManager + "</option>"
                    $("#selManage").append(tp);
                })
            }
        })

        QueryProduct();
    })
     
    function QueryProduct() {
        var obj = {
            Query:query 
        };
        //产品列表显示
        $.ajax({
            url: "/Product/GetProducts",
            type: "POST",
            dataType: "json",
            data: obj,
            success: function (res) {
                var ts = "";
                $(res.Products).each(function () {
                    ts += "<tr>"
                        + "<td>" + this.ProductId + "</td>"
                        + "<td>" + this.ProductName + "</td>"
                        + "<td>" + this.CreateTime + "</td>"
                        + "<td>" + this.ProductManager + "</td>"
                        + "<td>" + this.TradeName + "</td>"
                        + "<td>" + this.AddressName + "</td>"
                        + "<td>" + this.StageName + "</td>"
                        + "<td>" + this.ProductDetail + "</td>"
                        + "<td><a>删除</a></td>"
                        + "</tr>";
                })
                $("#tb").html(ts);
            }
        })

        $("#ProductQuery").click(function () {
            var query = {
                tradeId: $("#selTrea").val(),
                stageId: $("#selStage").val(),
                addressId: $("#selAddress").val(),
                productId: $("#selManage").val(),
                productName: $("#txtname").val()
            }
            QueryProduct(query);
        })
    }
</script>

